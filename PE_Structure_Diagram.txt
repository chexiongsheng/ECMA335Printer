┌─────────────────────────────────────────────────────────────────────────┐
│                          .NET PE File Structure                         │
│                     (ECMA-335 Assembly Format)                          │
└─────────────────────────────────────────────────────────────────────────┘

 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
┌───────────────────────────────────────────────────────────────┐
│                      DOS Header (64 bytes)                    │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │ Signature 'MZ' (0x5A4D)     │  ...other fields...       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │              PE Header Offset @ 0x3C (4 bytes)          │  │
│  └─────────────────────────────────────────────────────────┘  │
├───────────────────────────────────────────────────────────────┤
│                   DOS Stub (Variable size)                    │
│                    (Legacy DOS program)                       │
├───────────────────────────────────────────────────────────────┤
│              PE Signature 'PE\0\0' (4 bytes)                  │
│                      (0x00004550)                             │
├───────────────────────────────────────────────────────────────┤
│                    COFF Header (20 bytes)                     │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │ Machine (2)    │ NumberOfSections (2)                   │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │                  TimeDateStamp (4 bytes)                │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │              PointerToSymbolTable (4 bytes)             │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │                NumberOfSymbols (4 bytes)                │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ SizeOfOptionalHeader (2) │ Characteristics (2)          │  │
│  └─────────────────────────────────────────────────────────┘  │
├───────────────────────────────────────────────────────────────┤
│    ╔═══════════════════════════════════════════════════════╗  │
│    ║   Optional Header (224 bytes PE32 / 240 bytes PE32+)  ║  │
│    ╚═══════════════════════════════════════════════════════╝  │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │ P 1: Standard Fields (96 bytes PE32 / 112 bytes PE32+)  |  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Magic (2)      │ Linker Version (2)                     │  │
│  │  0x10B=PE32 / 0x20B=PE32+                               │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │                   SizeOfCode (4 bytes)                  │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │              SizeOfInitializedData (4 bytes)            │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │            SizeOfUninitializedData (4 bytes)            │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │               AddressOfEntryPoint (4 bytes)             │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │                  BaseOfCode (4 bytes)                   │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │            ImageBase (4 bytes PE32 / 8 bytes PE32+)     │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │  SectionAlignment (4)  │  FileAlignment (4)             │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │  OS Version (4)        │  Image Version (4)             │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │  Subsystem Version (4) │  Win32VersionValue (4)         │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │                  SizeOfImage (4 bytes)                  │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │                 SizeOfHeaders (4 bytes)                 │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │                   CheckSum (4 bytes)                    │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │  Subsystem (2)     │  DllCharacteristics (2)            │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │         SizeOfStackReserve (4/8 bytes)                  │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │          SizeOfStackCommit (4/8 bytes)                  │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │          SizeOfHeapReserve (4/8 bytes)                  │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │           SizeOfHeapCommit (4/8 bytes)                  │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │  LoaderFlags (4)       │  NumberOfRvaAndSizes (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ P 2: Data Directories (128 bytes = 16 entries × 8)      │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 0:  Export Table         RVA (4) │ Size (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 1:  Import Table         RVA (4) │ Size (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 2:  Resource Table       RVA (4) │ Size (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 3:  Exception Table      RVA (4) │ Size (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 4:  Certificate Table    RVA (4) │ Size (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 5:  Base Relocation      RVA (4) │ Size (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 6:  Debug                RVA (4) │ Size (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 7:  Architecture         RVA (4) │ Size (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 8:  Global Ptr           RVA (4) │ Size (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 9:  TLS Table            RVA (4) │ Size (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 10: Load Config Table    RVA (4) │ Size (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 11: Bound Import         RVA (4) │ Size (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 12: IAT                  RVA (4) │ Size (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 13: Delay Import Desc    RVA (4) │ Size (4)       │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 14: CLI Header (.NET)    RVA (4) │ Size (4)  ◄──  │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ Entry 15: Reserved             RVA (4) │ Size (4)       │  │
│  └─────────────────────────────────────────────────────────┘  │
│    ╚═══════════════════════════════════════════════════════╝  │
│         (End of Optional Header - Total 224/240 bytes)        │
├───────────────────────────────────────────────────────────────┤
│         Section Headers (40 bytes × N sections)               │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │                    Name (8 bytes)                       │  │
│  │              (e.g., ".text", ".rsrc")                   │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │  VirtualSize (4)       │  VirtualAddress (4)            │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │  SizeOfRawData (4)     │  PointerToRawData (4)          │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │  PointerToRelocations (4) │ PointerToLinenumbers (4)    │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ NumOfRelocations (2) │ NumOfLinenumbers (2)             │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │                 Characteristics (4 bytes)               │  │
│  └─────────────────────────────────────────────────────────┘  │
│                    ... repeat for each section ...            │
├───────────────────────────────────────────────────────────────┤
│                    Section Data (.text)                       │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │                  CLI Header (72 bytes)                  │  │
│  │  ┌───────────────────────────────────────────────────┐  │  │
│  │  │                    Cb (4 bytes)                   │  │  │
│  │  │              (Size of this header)                │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │ MajorRuntimeVer (2) │ MinorRuntimeVer (2)         │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │  MetadataRVA (4)    │  MetadataSize (4)           │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │  Flags (4)          │  EntryPointToken (4)        │  │  │
│  │  │  (ILOnly, 32Bit,    │  (Method token or RVA)      │  │  │
│  │  │   StrongNameSigned) │                             │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │  ResourcesRVA (4)   │  ResourcesSize (4)          │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │ StrongNameSigRVA(4) │ StrongNameSigSize (4)       │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │  CodeManagerTable (4) │ CodeManagerTableSize (4)  │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │  VTableFixupsRVA (4)  │ VTableFixupsSize (4)      │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │  ExportAddressTableJumps (4) │ Reserved (4)       │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │  ManagedNativeHeaderRVA (4) │ ManagedNativeSize   │  │  │
│  │  └───────────────────────────────────────────────────┘  │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │                 Metadata Root (Variable)                │  │
│  │  ┌───────────────────────────────────────────────────┐  │  │
│  │  │         Signature 'BSJB' (0x424A5342)             │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │ MajorVersion (2)    │ MinorVersion (2)            │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │                  Reserved (4 bytes)               │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │               VersionLength (4 bytes)             │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │          Version String (variable, aligned)       │  │  │
│  │  │     (e.g., "v4.0.30319" padded to 4-byte align)   │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │ Flags (2)           │ NumberOfStreams (2)         │  │  │
│  │  └───────────────────────────────────────────────────┘  │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │              Stream Headers (Variable size)             │  │
│  │  For each stream (typically 5 streams):                 │  │
│  │  ┌───────────────────────────────────────────────────┐  │  │
│  │  │  Offset (4)         │  Size (4)                   │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │          Name (null-terminated, aligned)          │  │  │
│  │  │     (e.g., "#~", "#Strings", "#US", "#GUID",      │  │  │
│  │  │            "#Blob")                               │  │  │
│  │  └───────────────────────────────────────────────────┘  │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │              Metadata Streams (Variable size)           │  │
│  │  ┌───────────────────────────────────────────────────┐  │  │
│  │  │ Stream #~ or #- : Metadata Tables (compressed)    │  │  │
│  │  │  ┌─────────────────────────────────────────────┐  │  │  │
│  │  │  │ Reserved (4) │ MajorVersion (1) │ Minor (1) │  │  │  │
│  │  │  ├─────────────────────────────────────────────┤  │  │  │
│  │  │  │ HeapSizes (1) │ Reserved (1) │ Valid (8)    │  │  │  │
│  │  │  ├─────────────────────────────────────────────┤  │  │  │
│  │  │  │              Sorted (8 bytes)               │  │  │  │
│  │  │  ├─────────────────────────────────────────────┤  │  │  │
│  │  │  │         Row counts for each table           │  │  │  │
│  │  │  │  (4 bytes per table, only for valid tables) │  │  │  │
│  │  │  ├─────────────────────────────────────────────┤  │  │  │
│  │  │  │              Table data rows                │  │  │  │
│  │  │  │  Tables: Module, TypeRef, TypeDef, Field,   │  │  │  │
│  │  │  │  MethodDef, Param, InterfaceImpl, MemberRef,│  │  │  │
│  │  │  │  Constant, CustomAttribute, FieldMarshal,   │  │  │  │
│  │  │  │  DeclSecurity, ClassLayout, FieldLayout,    │  │  │  │
│  │  │  │  StandAloneSig, EventMap, Event, PropertyMap│  │  │  │
│  │  │  │  Property, MethodSemantics, MethodImpl,     │  │  │  │
│  │  │  │  ModuleRef, TypeSpec, ImplMap, FieldRVA,    │  │  │  │
│  │  │  │  Assembly, AssemblyProcessor, AssemblyOS,   │  │  │  │
│  │  │  │  AssemblyRef, AssemblyRefProcessor,         │  │  │  │
│  │  │  │  AssemblyRefOS, File, ExportedType,         │  │  │  │
│  │  │  │  ManifestResource, NestedClass,             │  │  │  │
│  │  │  │  GenericParam, MethodSpec, GenericParamCons │  │  │  │
│  │  │  └─────────────────────────────────────────────┘  │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │ Stream #Strings : String heap                     │  │  │
│  │  │   Null-terminated UTF-8 strings indexed by offset │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │ Stream #US : User string heap                     │  │  │
│  │  │   Length-prefixed UTF-16 strings (for ldstr)      │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │ Stream #GUID : GUID heap                          │  │  │
│  │  │   Array of 16-byte GUIDs indexed by 1-based index │  │  │
│  │  ├───────────────────────────────────────────────────┤  │  │
│  │  │ Stream #Blob : Binary large object heap           │  │  │
│  │  │   Length-prefixed binary data (signatures, etc.)  │  │  │
│  │  └───────────────────────────────────────────────────┘  │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │                    IL Code (Variable)                   │  │
│  │   Method bodies with IL instructions and exception      │  │
│  │   handling clauses                                      │  │
│  └─────────────────────────────────────────────────────────┘  │
├───────────────────────────────────────────────────────────────┤
│              Other Sections (.rsrc, .reloc, etc.)             │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │ .rsrc : Resources (images, strings, etc.)               │  │
│  ├─────────────────────────────────────────────────────────┤  │
│  │ .reloc : Base relocations for address fixups            │  │
│  └─────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────┘

Legend:
  RVA = Relative Virtual Address (offset from image base in memory)
  (N) = Size in bytes
  ◄── = Important for .NET assemblies
  
Notes:
  • All multi-byte values are stored in little-endian format
  • Strings in metadata are UTF-8 encoded (except #US which is UTF-16)
  • Table indices can be 2 or 4 bytes depending on row counts (HeapSizes flag)
  • The CLI Header (Entry 14) is what makes this a .NET assembly
  • Metadata tables use compressed tokens for space efficiency

┌─────────────────────────────────────────────────────────────────────────┐
│                  Metadata and IL Relationship Diagram                   │
│                   (How Metadata Links to IL Code)                       │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                    Metadata Tables (#~ Stream)                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │ MethodDef Table (0x06) - Method Definitions                       │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │ Row 1:                                                      │  │  │
│  │  │   RVA = 0x00002050  ──────────────────────┐                 │  │  │
│  │  │   ImplFlags = 0x0000                      │                 │  │  │
│  │  │   Flags = 0x0086 (Public|HideBySig)       │                 │  │  │
│  │  │   Name = 0x0123 → "#Strings[0x0123]"      │                 │  │  │
│  │  │                   = "Main"                │                 │  │  │
│  │  │   Signature = 0x0045 → "#Blob[0x0045]"    │                 │  │  │
│  │  │   ParamList = 0x0001 → Param Table[1]     │                 │  │  │
│  │  ├─────────────────────────────────────────────────────────────┤  │  │
│  │  │ Row 2:                                                      │  │  │
│  │  │   RVA = 0x00002080  ──────────────────────┼────┐            │  │  │
│  │  │   ImplFlags = 0x0000                      │    │            │  │  │
│  │  │   Flags = 0x0086                          │    │            │  │  │
│  │  │   Name = 0x0130 → "GetValue"              │    │            │  │  │
│  │  │   Signature = 0x0052                      │    │            │  │  │
│  │  │   ParamList = 0x0001                      │    │            │  │  │
│  │  ├─────────────────────────────────────────────────────────────┤  │  │
│  │  │ Row 3:                                                      │  │  │
│  │  │   RVA = 0x00000000  ← Abstract/Interface  │    │            │  │  │
│  │  │   ImplFlags = 0x0400 (Abstract)           │    │            │  │  │
│  │  │   Flags = 0x0406                          │    │            │  │  │
│  │  │   Name = 0x0145 → "DoSomething"           │    │            │  │  │
│  │  │   Signature = 0x0060                      │    │            │  │  │
│  │  │   ParamList = 0x0002                      │    │            │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │ FieldRVA Table (0x1D) - Field Initial Data                        │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │ Row 1:                                                      │  │  │
│  │  │   RVA = 0x00002200  ──────────────────────┼────┼────┐       │  │  │
│  │  │   Field = 0x0005 → Field Table[5]         │    │    │       │  │  │
│  │  │   (Static field with initial data)        │    │    │       │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                    │                          │         │
                    │ RVA points to            │         │
                    ↓                          ↓         ↓
┌─────────────────────────────────────────────────────────────────────────┐
│                  .text Section (IL Code & Data)                         │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │ File Offset: 0x00000400 (example)                                 │  │
│  │ Virtual Address: 0x00002000                                       │  │
│  │                                                                   │  │
│  │ ┌─────────────────────────────────────────────────────────────┐   │  │
│  │ │ RVA 0x00002050: Method Body for "Main"                      │   │  │
│  │ │  ┌───────────────────────────────────────────────────────┐  │   │  │
│  │ │  │ Method Header (Tiny or Fat format)                    │  │   │  │
│  │ │  │   Flags: 0x13 (Fat format, InitLocals)                │  │   │  │
│  │ │  │   MaxStack: 8                                         │  │   │  │
│  │ │  │   CodeSize: 13 bytes                                  │  │   │  │
│  │ │  │   LocalVarSigTok: 0x11000001 → StandAloneSig Table[1] │  │   │  │
│  │ │  ├───────────────────────────────────────────────────────┤  │   │  │
│  │ │  │ IL Instructions:                                      │  │   │  │
│  │ │  │   0x00: 72 01 00 00 70    ldstr "Hello World"         │  │   │  │
│  │ │  │                          (token 0x70000001 → #US)     │  │   │  │
│  │ │  │   0x05: 28 04 00 00 0A    call WriteLine              │  │   │  │
│  │ │  │                          (token 0x0A000004 → MemberRef│  │   │  │
│  │ │  │   0x0A: 00                nop                         │  │   │  │
│  │ │  │   0x0B: 2A                ret                         │  │   │  │
│  │ │  ├───────────────────────────────────────────────────────┤  │   │  │
│  │ │  │ Exception Handling Clauses (if any)                   │  │   │  │
│  │ │  │   Flags, TryOffset, TryLength, HandlerOffset, etc.    │  │   │  │
│  │ │  └───────────────────────────────────────────────────────┘  │   │  │
│  │ └─────────────────────────────────────────────────────────────┘   │  │
│  │                                                                   │  │
│  │ ┌─────────────────────────────────────────────────────────────┐   │  │
│  │ │ RVA 0x00002080: Method Body for "GetValue"                  │   │  │
│  │ │  ┌───────────────────────────────────────────────────────┐  │   │  │
│  │ │  │ Method Header (Tiny format)                           │  │   │  │
│  │ │  │   Flags: 0x06 (Tiny format)                           │  │   │  │
│  │ │  │   CodeSize: 2 bytes (encoded in flags)                │  │   │  │
│  │ │  ├───────────────────────────────────────────────────────┤  │   │  │
│  │ │  │ IL Instructions:                                      │  │   │  │
│  │ │  │   0x00: 1F 05             ldc.i4.s 5                  │  │   │  │
│  │ │  │   0x02: 2A                ret                         │  │   │  │
│  │ │  └───────────────────────────────────────────────────────┘  │   │  │
│  │ └─────────────────────────────────────────────────────────────┘   │  │
│  │                                                                   │  │
│  │ ┌─────────────────────────────────────────────────────────────┐   │  │
│  │ │ RVA 0x00002200: Static Field Initial Data                   │   │  │
│  │ │  ┌───────────────────────────────────────────────────────┐  │   │  │
│  │ │  │ Raw bytes for field initialization                    │  │   │  │
│  │ │  │   01 02 03 04 05 06 07 08 ...                         │  │   │  │
│  │ │  │   (e.g., array initializer data)                      │  │   │  │
│  │ │  └───────────────────────────────────────────────────────┘  │   │  │
│  │ └─────────────────────────────────────────────────────────────┘   │  │
│  └───────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                      RVA to File Offset Conversion                      │
└─────────────────────────────────────────────────────────────────────────┘

  Given: RVA = 0x00002050 (from MethodDef.RVA)
  
  Step 1: Find the section containing this RVA
  ┌─────────────────────────────────────────────────────────────┐
  │ Section: .text                                              │
  │   VirtualAddress = 0x00002000                               │
  │   VirtualSize = 0x00001000                                  │
  │   PointerToRawData = 0x00000400                             │
  │   SizeOfRawData = 0x00001000                                │
  │                                                             │
  │ Check: 0x00002000 ≤ 0x00002050 < 0x00003000  ✓              │
  └─────────────────────────────────────────────────────────────┘
  
  Step 2: Calculate file offset
  ┌─────────────────────────────────────────────────────────────┐
  │ FileOffset = PointerToRawData + (RVA - VirtualAddress)      │
  │            = 0x00000400 + (0x00002050 - 0x00002000)         │
  │            = 0x00000400 + 0x00000050                        │
  │            = 0x00000450                                     │
  └─────────────────────────────────────────────────────────────┘
  
  Step 3: Read method body from file offset 0x00000450

┌─────────────────────────────────────────────────────────────────────────┐
│                    Key Relationship Summary                             │
└─────────────────────────────────────────────────────────────────────────┘

  1. MethodDef.RVA → Method Body (IL Code)
     • RVA = 0 means abstract/interface method (no implementation)
     • RVA ≠ 0 points to method body in .text section
  
  2. FieldRVA.RVA → Field Initial Data
     • Used for static fields with initial values
     • Points to raw data in .text or .data section
  
  3. Method Body Structure:
     ┌──────────────────────────────────────────┐
     │ Header (Tiny: 1 byte, Fat: 12 bytes)     │
     ├──────────────────────────────────────────┤
     │ IL Instructions (variable length)        │
     ├──────────────────────────────────────────┤
     │ Exception Clauses (optional, if Fat)     │
     └──────────────────────────────────────────┘
  
  4. IL Instructions Reference Metadata via Tokens:
     • ldstr → #US heap (User Strings)
     • call/callvirt → MemberRef/MethodDef tables
     • newobj → MemberRef/MethodDef tables
     • ldfld/stfld → Field/MemberRef tables
     • ldtoken → Any metadata table
  
  5. Token Format (4 bytes):
     ┌────────────┬─────────────────────────────┐
     │ Table ID   │ Row Index                   │
     │ (1 byte)   │ (3 bytes)                   │
     └────────────┴─────────────────────────────┘
     
     Examples:
     • 0x06000001 → MethodDef Table, Row 1
     • 0x0A000004 → MemberRef Table, Row 4
     • 0x02000003 → TypeDef Table, Row 3
     • 0x70000001 → #US heap, offset 1
  
  6. Complete Lookup Flow:
     User Code → Compiler → PE File
                              ↓
     ┌────────────────────────────────────────┐
     │ 1. Find method in MethodDef table      │
     │ 2. Read RVA field                      │
     │ 3. Convert RVA to file offset          │
     │ 4. Read method body header             │
     │ 5. Parse IL instructions               │
     │ 6. Resolve tokens to metadata          │
     └────────────────────────────────────────┘
